
<h2> All Task Lists </h2>

<% @lists.each  do |list| %>
 <h3><%= link_to list.title, list_path(list) %></h3>
 <ul>
 <% list.tasks.each do |task| %>
 <li id="task-<%= task.id %>">
    <span class="title" id="taskTitle-<%= task.id %>"><%= link_to task.title, list_task_path(list, task) %> |</span>
    <span id="taskStatus-<%= task.id %>"><%= task.status %> |</span>
    <span id="taskDuedate-<%= task.id %>"><%= task.due_date %> |</span>
    <span id="taskUser-<%= task.id %>"><%= task.user_info ||  link_to('Claim Task', edit_list_task_path(list,task)) %></span>
</li>
<% end %>
</ul>
<% end %><br>

<%= link_to_if(current_user.admin?, 'Add List', new_list_path) %>


<script type="text/javascript">
$(function(){
  $("span.title").on("click", function(e) {
    e.preventDefault();
    var url = this.childNodes[0].href + ".json";
    $.get(url, function(data){
      var id = data["id"]
      var taskTitle = "<h4>" + data["title"] + "</h4>";
      var taskDescription = "<p> Description: " + "<i>"+ data["description"]+ "</i>" + "</p>";
      var taskStatus = "<p>Status: " + "<i>"+ data["status"] + "</i>" + "</p>";
      var taskDuedate = "<p>Due Date: " + "<i>"+ data["due_date"] + "</i>" + "</p>";
      var taskUser = "<p>Assigned to: " + $("#taskUser-" + id).html() + "</p>";
      var taskSeperator = "<p>----------------------------------</p>";
      
      var taskJ = taskTitle + taskDescription + taskStatus + taskDuedate + taskUser+ taskSeperator;

      $("#task-" + id).html(taskJ);
      });
    });
  });
  </script>